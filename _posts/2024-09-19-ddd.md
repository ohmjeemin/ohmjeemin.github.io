---
title: 도메인 주도 설계에 대해 알아보자
date: 2024-09-19 10:00:00 +/- TTTT
categories: [Dev, ETC]
tags: [DDD]
pin: true
---

## 도메인 주도 설계 (DDD)
---
도메인 주도 설계는 간단히 말해 코드의 구조를 도메인의 구조와 일치시키는 것입니다. 즉, 소프트웨어 아키텍처가 비즈니스 로직을 반영하고, 비즈니스의 핵심 개념과 일관되도록 코드를 구성하는 것을 목표로 합니다.

## 도메인
---
도메인은 비즈니스에서 개발해야 할 특정 영역을 의미합니다. 이 영역은 비즈니스의 목적을 반영하며, 소프트웨어의 구조와도 긴밀하게 연관됩니다. 개발해야 할 도메인을 분류하는 과정을 **디스틸레이션(Distillation)**이라고 합니다. 이는 도메인을 다음 네 가지로 나눕니다.

- 개발 안함: 해당 도메인은 개발 대상이 아니며, 무시할 수 있습니다.
- 지원: 외부에서 지원받는 영역으로, 외주나 외부 API 등을 이용해 처리합니다.
- 일반: 일반적인 비즈니스 로직에 해당하는 부분입니다.
- 핵심: 비즈니스의 핵심 가치를 담고 있는 중요한 도메인입니다. 가장 중요한 부분이며, 직접 개발하고 유지보수해야 합니다.

## 바운디드 컨텍스트 (Bounded Context)
---
도메인 주도 설계에서 중요한 개념 중 하나가 **바운디드 컨텍스트(Bounded Context)**입니다. 이는 특정 도메인이 적용되는 경계를 정의합니다. 예를 들어, '발송'이라는 개념은 물류 도메인에서는 상품을 고객에게 보내는 의미로 쓰이고, 이메일 도메인에서는 메시지를 전송하는 의미로 쓰일 수 있습니다. 이러한 개념들은 서로 다른 바운디드 컨텍스트 내에서 독립적으로 다뤄집니다.

## 애그리게이트(Aggregate)
---
애그리게이트는 도메인 주도 설계(DDD)에서 비즈니스 규칙과 일관성을 관리하는 단위입니다. 애그리게이트는 특정 도메인 객체 그룹을 의미하며, 객체들 간의 상호작용을 제어하고 외부에 노출되는 경계를 설정해줍니다. 이를 통해 시스템의 일관성을 유지하고 비즈니스 규칙을 지킬 수 있게 해줍니다.  

애그리게이트 내에서 중요한 점은 **애그리게이트 루트(Aggregate Root)**만 식별자를 가지면 된다는 점입니다. 모든 변경 작업은 애그리게이트 루트를 통해서만 이루어져야 합니다. 하위 객체들은 별도로 식별자가 없어도 됩니다. 


## 일관성(Consistency)과 애그리게이트
---
일관성에는 크게 두 가지가 있습니다.  

- Transactional Consistency (TC): 트랜잭션 내에서 즉각적인 일관성을 보장하는 것입니다. 애그리게이트 내부에서 이루어지는 상태 변경은 트랜잭션 단위로 처리되며, 모든 변경이 성공적으로 완료될 때까지 외부에 반영되지 않습니다.

- Eventual Consistency (EC): 즉각적인 일관성을 보장하지 않고, 언젠가 동기화가 이루어지면 충분한 경우입니다. 여러 시스템이 분산되어 있거나, 비동기적으로 데이터를 처리할 때 흔히 사용됩니다.

## 애그리게이트에서의 Transactional Consistency
---
애그리게이트는 **Transactional Consistency(TC)**를 보장해야 하는 단위입니다. 즉, 애그리게이트 내부의 상태는 언제나 **불변식(invariant)**을 유지해야 합니다. 불변식이란, 애그리게이트 내에서 비즈니스 규칙이 언제나 만족된다는 것을 의미합니다. 예를 들어, '주문' 애그리게이트는 개별 상품 항목들의 합계와 총 금액이 일치해야 한다는 비즈니스 규칙을 가질 수 있습니다. 주문 내에 상품을 추가하거나 삭제할 때마다 애그리게이트 루트는 규칙을 유지해야 합닌다.

애그리게이트 외부에서는 이러한 불변식이 자동으로 보장되지 않기 때문에, 애그리게이트의 경계는 비즈니스 규칙과 일관성을 보장하는 중요한 역할을 합니다.

## 애그리게이트 하위의 Eventual Consistency
---
애그리게이트 내부에서 일관성을 유지하는 것이 중요하지만, 애그리게이트 경계 바깥에서는 **Eventual Consistency(EC)**가 충분할 수 있습니다. 애그리게이트 외부의 여러 시스템이나 애그리게이트 간의 상태 동기화는 즉각적일 필요가 없고, 시간이 지나면서 동기화가 이루어져도 문제가 없는 경우가 많습니다.

## 애그리게이트의 구성
---
애그리게이트는 주로 **엔티티(Entity)**와 **밸류 오브젝트(Value Object, VO)**로 구성됩니다.

- 엔티티(Entity): 고유한 식별자를 가지며, 상태의 변경이 가능한 객체입니다. 애그리게이트 루트는 대부분 엔티티이며, 외부로부터 접근 가능한 식별자를 통해 구분됩니다. 엔티티는 다른 엔티티들과의 관계로 구성될 수 있으며, 이러한 관계는 **릴레이션(Relation)**으로 나타냅니다. 엔티티 간의 릴레이션을 통해 복잡한 비즈니스 로직을 처리할 수 있습니다.

- 밸류 오브젝트(Value Object, VO): 식별자를 가지지 않으며, 단순히 속성들을 모아서 표현하는 객체입니다. 불변성을 가지며, 상태를 변경하지 않고 값을 전달하는 데 중점을 둡니다. 밸류 오브젝트는 중요한 속성을 가지지만, 엔티티처럼 고유하게 구분되지 않고 여러 곳에서 재사용될 수 있습니다.

